============================= test session starts ==============================
platform linux -- Python 3.11.2, pytest-8.4.1, pluggy-1.6.0
rootdir: /opt/gregor_zwanziger
configfile: pyproject.toml
plugins: anyio-4.12.0
collected 27 items

tests/unit/test_configurable_thresholds.py FFFFFFFFFFFFFFFFFF.........   [100%]

=================================== FAILURES ===================================
_______ TestMetricDefinitionFields.test_display_thresholds_field_exists ________

self = <test_configurable_thresholds.TestMetricDefinitionFields object at 0x7f9d4d61e450>

    def test_display_thresholds_field_exists(self) -> None:
        """MetricDefinition must have a display_thresholds dict field."""
        md = get_metric("gust")
>       assert hasattr(md, "display_thresholds"), "display_thresholds field missing"
E       AssertionError: display_thresholds field missing
E       assert False
E        +  where False = hasattr(MetricDefinition(id='gust', label_de='Böen', unit='km/h', dp_field='gust_kmh', category='wind', default_aggregations=(... True}, default_enabled=True, friendly_label='', summary_fields={'max': 'gust_max_kmh'}, default_change_threshold=20.0), 'display_thresholds')

tests/unit/test_configurable_thresholds.py:23: AssertionError
_______ TestMetricDefinitionFields.test_highlight_threshold_field_exists _______

self = <test_configurable_thresholds.TestMetricDefinitionFields object at 0x7f9d4ca33f10>

    def test_highlight_threshold_field_exists(self) -> None:
        """MetricDefinition must have a highlight_threshold Optional[float] field."""
        md = get_metric("gust")
>       assert hasattr(md, "highlight_threshold"), "highlight_threshold field missing"
E       AssertionError: highlight_threshold field missing
E       assert False
E        +  where False = hasattr(MetricDefinition(id='gust', label_de='Böen', unit='km/h', dp_field='gust_kmh', category='wind', default_aggregations=(... True}, default_enabled=True, friendly_label='', summary_fields={'max': 'gust_max_kmh'}, default_change_threshold=20.0), 'highlight_threshold')

tests/unit/test_configurable_thresholds.py:29: AssertionError
_________ TestMetricDefinitionFields.test_risk_thresholds_field_exists _________

self = <test_configurable_thresholds.TestMetricDefinitionFields object at 0x7f9d4ca1e910>

    def test_risk_thresholds_field_exists(self) -> None:
        """MetricDefinition must have a risk_thresholds dict field."""
        md = get_metric("gust")
>       assert hasattr(md, "risk_thresholds"), "risk_thresholds field missing"
E       AssertionError: risk_thresholds field missing
E       assert False
E        +  where False = hasattr(MetricDefinition(id='gust', label_de='Böen', unit='km/h', dp_field='gust_kmh', category='wind', default_aggregations=(... True}, default_enabled=True, friendly_label='', summary_fields={'max': 'gust_max_kmh'}, default_change_threshold=20.0), 'risk_thresholds')

tests/unit/test_configurable_thresholds.py:34: AssertionError
______________ TestCatalogPopulation.test_gust_display_thresholds ______________

self = <test_configurable_thresholds.TestCatalogPopulation object at 0x7f9d4ca1ee90>

    def test_gust_display_thresholds(self) -> None:
        """Gust: yellow >= 50, red >= 80."""
        md = get_metric("gust")
>       assert md.display_thresholds == {"yellow": 50.0, "red": 80.0}
               ^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'MetricDefinition' object has no attribute 'display_thresholds'

tests/unit/test_configurable_thresholds.py:49: AttributeError
_____________ TestCatalogPopulation.test_gust_highlight_threshold ______________

self = <test_configurable_thresholds.TestCatalogPopulation object at 0x7f9d4ca1f910>

    def test_gust_highlight_threshold(self) -> None:
        """Gust highlight at > 60 km/h."""
        md = get_metric("gust")
>       assert md.highlight_threshold == 60.0
               ^^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'MetricDefinition' object has no attribute 'highlight_threshold'

tests/unit/test_configurable_thresholds.py:54: AttributeError
_______________ TestCatalogPopulation.test_gust_risk_thresholds ________________

self = <test_configurable_thresholds.TestCatalogPopulation object at 0x7f9d4ca1c110>

    def test_gust_risk_thresholds(self) -> None:
        """Gust risk: medium > 50, high > 70."""
        md = get_metric("gust")
>       assert md.risk_thresholds == {"medium": 50.0, "high": 70.0}
               ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'MetricDefinition' object has no attribute 'risk_thresholds'

tests/unit/test_configurable_thresholds.py:59: AttributeError
_____________ TestCatalogPopulation.test_wind_highlight_threshold ______________

self = <test_configurable_thresholds.TestCatalogPopulation object at 0x7f9d4ca1e050>

    def test_wind_highlight_threshold(self) -> None:
        """Wind highlight at > 50 km/h."""
        md = get_metric("wind")
>       assert md.highlight_threshold == 50.0
               ^^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'MetricDefinition' object has no attribute 'highlight_threshold'

tests/unit/test_configurable_thresholds.py:64: AttributeError
_______________ TestCatalogPopulation.test_wind_risk_thresholds ________________

self = <test_configurable_thresholds.TestCatalogPopulation object at 0x7f9d4ca1c610>

    def test_wind_risk_thresholds(self) -> None:
        """Wind risk: medium > 50, high > 70."""
        md = get_metric("wind")
>       assert md.risk_thresholds == {"medium": 50.0, "high": 70.0}
               ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'MetricDefinition' object has no attribute 'risk_thresholds'

tests/unit/test_configurable_thresholds.py:69: AttributeError
_________ TestCatalogPopulation.test_precipitation_display_thresholds __________

self = <test_configurable_thresholds.TestCatalogPopulation object at 0x7f9d4ca1d410>

    def test_precipitation_display_thresholds(self) -> None:
        """Precipitation: blue >= 5 mm."""
        md = get_metric("precipitation")
>       assert md.display_thresholds == {"blue": 5.0}
               ^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'MetricDefinition' object has no attribute 'display_thresholds'

tests/unit/test_configurable_thresholds.py:74: AttributeError
___________ TestCatalogPopulation.test_precipitation_risk_thresholds ___________

self = <test_configurable_thresholds.TestCatalogPopulation object at 0x7f9d4ca1d790>

    def test_precipitation_risk_thresholds(self) -> None:
        """Precipitation risk: medium > 20 mm."""
        md = get_metric("precipitation")
>       assert md.risk_thresholds == {"medium": 20.0}
               ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'MetricDefinition' object has no attribute 'risk_thresholds'

tests/unit/test_configurable_thresholds.py:79: AttributeError
________ TestCatalogPopulation.test_rain_probability_display_thresholds ________

self = <test_configurable_thresholds.TestCatalogPopulation object at 0x7f9d4ca1dad0>

    def test_rain_probability_display_thresholds(self) -> None:
        """Rain probability: blue >= 80%."""
        md = get_metric("rain_probability")
>       assert md.display_thresholds == {"blue": 80.0}
               ^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'MetricDefinition' object has no attribute 'display_thresholds'

tests/unit/test_configurable_thresholds.py:84: AttributeError
____________ TestCatalogPopulation.test_rain_probability_highlight _____________

self = <test_configurable_thresholds.TestCatalogPopulation object at 0x7f9d4ca126d0>

    def test_rain_probability_highlight(self) -> None:
        """Rain probability highlight at >= 80%."""
        md = get_metric("rain_probability")
>       assert md.highlight_threshold == 80.0
               ^^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'MetricDefinition' object has no attribute 'highlight_threshold'

tests/unit/test_configurable_thresholds.py:89: AttributeError
______________ TestCatalogPopulation.test_cape_display_thresholds ______________

self = <test_configurable_thresholds.TestCatalogPopulation object at 0x7f9d4ca12b10>

    def test_cape_display_thresholds(self) -> None:
        """CAPE: yellow >= 1000 J/kg."""
        md = get_metric("cape")
>       assert md.display_thresholds == {"yellow": 1000.0}
               ^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'MetricDefinition' object has no attribute 'display_thresholds'

tests/unit/test_configurable_thresholds.py:94: AttributeError
_______________ TestCatalogPopulation.test_cape_risk_thresholds ________________

self = <test_configurable_thresholds.TestCatalogPopulation object at 0x7f9d4ca1c890>

    def test_cape_risk_thresholds(self) -> None:
        """CAPE risk: medium >= 1000, high >= 2000."""
        md = get_metric("cape")
>       assert md.risk_thresholds == {"medium": 1000.0, "high": 2000.0}
               ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'MetricDefinition' object has no attribute 'risk_thresholds'

tests/unit/test_configurable_thresholds.py:99: AttributeError
___________ TestCatalogPopulation.test_visibility_display_thresholds ___________

self = <test_configurable_thresholds.TestCatalogPopulation object at 0x7f9d4d616950>

    def test_visibility_display_thresholds(self) -> None:
        """Visibility: orange if < 500m (less-than condition)."""
        md = get_metric("visibility")
>       assert md.display_thresholds == {"orange_lt": 500.0}
               ^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'MetricDefinition' object has no attribute 'display_thresholds'

tests/unit/test_configurable_thresholds.py:104: AttributeError
____________ TestCatalogPopulation.test_visibility_risk_thresholds _____________

self = <test_configurable_thresholds.TestCatalogPopulation object at 0x7f9d4ca13150>

    def test_visibility_risk_thresholds(self) -> None:
        """Visibility risk: high if < 100m."""
        md = get_metric("visibility")
>       assert md.risk_thresholds == {"high_lt": 100.0}
               ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'MetricDefinition' object has no attribute 'risk_thresholds'

tests/unit/test_configurable_thresholds.py:109: AttributeError
____________ TestCatalogPopulation.test_wind_chill_risk_thresholds _____________

self = <test_configurable_thresholds.TestCatalogPopulation object at 0x7f9d4ca13010>

    def test_wind_chill_risk_thresholds(self) -> None:
        """Wind chill risk: high if < -20 C."""
        md = get_metric("wind_chill")
>       assert md.risk_thresholds == {"high_lt": -20.0}
               ^^^^^^^^^^^^^^^^^^
E       AttributeError: 'MetricDefinition' object has no attribute 'risk_thresholds'

tests/unit/test_configurable_thresholds.py:114: AttributeError
____ TestCatalogPopulation.test_metrics_without_thresholds_have_empty_dicts ____

self = <test_configurable_thresholds.TestCatalogPopulation object at 0x7f9d4ca12cd0>

    def test_metrics_without_thresholds_have_empty_dicts(self) -> None:
        """Metrics not in threshold list should have empty defaults."""
        md = get_metric("temperature")
>       assert md.display_thresholds == {}
               ^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'MetricDefinition' object has no attribute 'display_thresholds'

tests/unit/test_configurable_thresholds.py:119: AttributeError
=========================== short test summary info ============================
FAILED tests/unit/test_configurable_thresholds.py::TestMetricDefinitionFields::test_display_thresholds_field_exists
FAILED tests/unit/test_configurable_thresholds.py::TestMetricDefinitionFields::test_highlight_threshold_field_exists
FAILED tests/unit/test_configurable_thresholds.py::TestMetricDefinitionFields::test_risk_thresholds_field_exists
FAILED tests/unit/test_configurable_thresholds.py::TestCatalogPopulation::test_gust_display_thresholds
FAILED tests/unit/test_configurable_thresholds.py::TestCatalogPopulation::test_gust_highlight_threshold
FAILED tests/unit/test_configurable_thresholds.py::TestCatalogPopulation::test_gust_risk_thresholds
FAILED tests/unit/test_configurable_thresholds.py::TestCatalogPopulation::test_wind_highlight_threshold
FAILED tests/unit/test_configurable_thresholds.py::TestCatalogPopulation::test_wind_risk_thresholds
FAILED tests/unit/test_configurable_thresholds.py::TestCatalogPopulation::test_precipitation_display_thresholds
FAILED tests/unit/test_configurable_thresholds.py::TestCatalogPopulation::test_precipitation_risk_thresholds
FAILED tests/unit/test_configurable_thresholds.py::TestCatalogPopulation::test_rain_probability_display_thresholds
FAILED tests/unit/test_configurable_thresholds.py::TestCatalogPopulation::test_rain_probability_highlight
FAILED tests/unit/test_configurable_thresholds.py::TestCatalogPopulation::test_cape_display_thresholds
FAILED tests/unit/test_configurable_thresholds.py::TestCatalogPopulation::test_cape_risk_thresholds
FAILED tests/unit/test_configurable_thresholds.py::TestCatalogPopulation::test_visibility_display_thresholds
FAILED tests/unit/test_configurable_thresholds.py::TestCatalogPopulation::test_visibility_risk_thresholds
FAILED tests/unit/test_configurable_thresholds.py::TestCatalogPopulation::test_wind_chill_risk_thresholds
FAILED tests/unit/test_configurable_thresholds.py::TestCatalogPopulation::test_metrics_without_thresholds_have_empty_dicts
========================= 18 failed, 9 passed in 0.13s =========================
